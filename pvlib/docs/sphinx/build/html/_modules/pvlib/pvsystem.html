<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pvlib.pvsystem &mdash; PV LIB 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="PV LIB 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">PV LIB 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pvlib.pvsystem</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pvl_tools</span>
<span class="kn">import</span> <span class="nn">scipy</span> 
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">lambertw</span>


<span class="k">def</span> <span class="nf">makelocationstruct</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="n">longitude</span><span class="p">,</span><span class="n">TZ</span><span class="p">,</span><span class="n">altitude</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">Name</span><span class="o">=</span><span class="s">&#39;Usr_input&#39;</span><span class="p">,</span><span class="n">State</span><span class="o">=</span><span class="s">&#39;Usr_input&#39;</span><span class="p">):</span>
<div class="viewcode-block" id="makelocationstruct"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.makelocationstruct.html#pvlib.pvsystem.makelocationstruct">[docs]</a>  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Create a struct to define a site location</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>

<span class="sd">  Latitude : float</span>
<span class="sd">            Positive north of equator, decimal notation</span>
<span class="sd">  Longitude : float </span>
<span class="sd">            Positive east of prime meridian, decimal notation</span>
<span class="sd">  TZ  : int</span>
<span class="sd">            Timezone in GMT offset</span>

<span class="sd">  Other Parameters</span>
<span class="sd">  ----------------</span>

<span class="sd">  altitude : float (optional, default=100)</span>
<span class="sd">            Altitude from sea level. Set to 100m if none input</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>

<span class="sd">  Location : struct</span>

<span class="sd">          *Location.latitude*</span>

<span class="sd">          *Location.longitude*</span>

<span class="sd">          *Location.TZ*</span>

<span class="sd">          *Location.altitude*</span>


<span class="sd">  See Also</span>
<span class="sd">  --------</span>

<span class="sd">  pvl_ephemeris</span>
<span class="sd">  pvl_alt2pres</span>
<span class="sd">  pvl_pres2alt</span>

<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>
  <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;latitude&#39;</span><span class="p">:(</span><span class="s">&#39;num&#39;</span><span class="p">,</span><span class="s">&#39;x&gt;=-90&#39;</span><span class="p">,</span><span class="s">&#39;x&lt;=90&#39;</span><span class="p">),</span>
          <span class="s">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;num&#39;</span><span class="p">,</span><span class="s">&#39;x&lt;=180&#39;</span><span class="p">,</span><span class="s">&#39;x&gt;=-180&#39;</span><span class="p">),</span>
          <span class="s">&#39;altitude&#39;</span><span class="p">:(</span><span class="s">&#39;num&#39;</span><span class="p">,</span><span class="s">&#39;default&#39;</span><span class="p">,</span><span class="s">&#39;default=100&#39;</span><span class="p">),</span>
          <span class="s">&#39;TZ&#39;</span><span class="p">:(</span><span class="s">&#39;num&#39;</span><span class="p">),</span>
          <span class="s">&#39;Name&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">,</span>
          <span class="s">&#39;State&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span>
          <span class="p">}</span>
  <span class="n">Location</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>


  <span class="k">return</span> <span class="n">Location</span>

<span class="k">def</span> <span class="nf">systemdef</span><span class="p">(</span><span class="n">TMYmeta</span><span class="p">,</span><span class="n">SurfTilt</span><span class="p">,</span> <span class="n">SurfAz</span><span class="p">,</span><span class="n">Albedo</span><span class="p">,</span><span class="n">SeriesModules</span><span class="p">,</span><span class="n">ParallelModules</span><span class="p">):</span></div>
<div class="viewcode-block" id="systemdef"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.systemdef.html#pvlib.pvsystem.systemdef">[docs]</a>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generates a dict of system paramters used throughout a simulation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    TMYmeta : struct or dict</span>
<span class="sd">                meta file generated from a TMY file using pvl_readtmy2 or pvl_readtmy3.</span>
<span class="sd">                It should contain at least the following fields: </span>

<span class="sd">                    ===============   ======  ====================  </span>
<span class="sd">                    meta field        format  description</span>
<span class="sd">                    ===============   ======  ====================  </span>
<span class="sd">                    meta.altitude     Float   site elevation</span>
<span class="sd">                    meta.latitude     Float   site latitude</span>
<span class="sd">                    meta.longitude    Float   site longitude</span>
<span class="sd">                    meta.Name         String  site name</span>
<span class="sd">                    meta.State        String  state</span>
<span class="sd">                    meta.TZ           Float   timezone</span>
<span class="sd">                    ===============   ======  ====================  </span>

<span class="sd">    SurfTilt : float or DataFrame</span>
<span class="sd">              Surface tilt angles in decimal degrees.</span>
<span class="sd">              SurfTilt must be &gt;=0 and &lt;=180. The tilt angle is defined as</span>
<span class="sd">              degrees from horizontal (e.g. surface facing up = 0, surface facing</span>
<span class="sd">              horizon = 90)</span>

<span class="sd">    SurfAz : float or DataFrame</span>
<span class="sd">            Surface azimuth angles in decimal degrees.</span>
<span class="sd">            SurfAz must be &gt;=0 and &lt;=360. The Azimuth convention is defined</span>
<span class="sd">            as degrees east of north (e.g. North = 0, South=180 East = 90, West = 270).</span>

<span class="sd">    Albedo : float or DataFrame </span>
<span class="sd">            Ground reflectance, typically 0.1-0.4 for</span>
<span class="sd">            surfaces on Earth (land), may increase over snow, ice, etc. May also </span>
<span class="sd">            be known as the reflection coefficient. Must be &gt;=0 and &lt;=1.</span>

<span class="sd">    SeriesModules : float</span>
<span class="sd">            Number of modules connected in series in a string. </span>

<span class="sd">    ParallelModules : int</span>
<span class="sd">            Number of strings connected in parallel.</span>
<span class="sd">    </span>
<span class="sd">    </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    Result : dict</span>

<span class="sd">                A dict with the following fields.</span>
<span class="sd">      </span>
<span class="sd">                    * &#39;SurfTilt&#39;</span>
<span class="sd">                    * &#39;SurfAz&#39;</span>
<span class="sd">                    * &#39;Albedo&#39;</span>
<span class="sd">                    * &#39;SeriesModules&#39;</span>
<span class="sd">                    * &#39;ParallelModules&#39;</span>
<span class="sd">                    * &#39;Lat&#39;</span>
<span class="sd">                    * &#39;Long&#39;</span>
<span class="sd">                    * &#39;TZ&#39;</span>
<span class="sd">                    * &#39;name&#39;</span>
<span class="sd">                    * &#39;altitude&#39;</span>


<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    pvl_readtmy3</span>
<span class="sd">    pvl_readtmy2</span>


<span class="sd">    &#39;&#39;&#39;</span>


    <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>
    <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;TMYmeta&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;SurfTilt&#39;</span><span class="p">:(</span><span class="s">&#39;num&#39;</span><span class="p">,</span><span class="s">&#39;x&gt;=0&#39;</span><span class="p">),</span>
            <span class="s">&#39;SurfAz&#39;</span><span class="p">:(</span><span class="s">&#39;num&#39;</span><span class="p">),</span>
            <span class="s">&#39;Albedo&#39;</span><span class="p">:(</span><span class="s">&#39;num&#39;</span><span class="p">,</span><span class="s">&#39;x&gt;=0&#39;</span><span class="p">),</span>
            <span class="s">&#39;SeriesModules&#39;</span><span class="p">:(</span><span class="s">&#39;default&#39;</span><span class="p">,</span><span class="s">&#39;default=1&#39;</span><span class="p">,</span><span class="s">&#39;num&#39;</span><span class="p">,</span><span class="s">&#39;x&gt;=0&#39;</span><span class="p">),</span>
            <span class="s">&#39;ParallelModules&#39;</span><span class="p">:(</span><span class="s">&#39;default&#39;</span><span class="p">,</span><span class="s">&#39;default=1&#39;</span><span class="p">,</span><span class="s">&#39;num&#39;</span><span class="p">,</span><span class="s">&#39;x&gt;=0&#39;</span><span class="p">)}</span>

    <span class="n">var</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>

    <span class="n">system</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;SurfTilt&#39;</span><span class="p">:</span><span class="n">var</span><span class="o">.</span><span class="n">SurfTilt</span><span class="p">,</span>
            <span class="s">&#39;SurfAz&#39;</span><span class="p">:</span><span class="n">var</span><span class="o">.</span><span class="n">SurfAz</span><span class="p">,</span>
            <span class="s">&#39;Albedo&#39;</span><span class="p">:</span><span class="n">var</span><span class="o">.</span><span class="n">Albedo</span><span class="p">,</span>
            <span class="s">&#39;SeriesModules&#39;</span><span class="p">:</span><span class="n">var</span><span class="o">.</span><span class="n">SeriesModules</span><span class="p">,</span>
            <span class="s">&#39;ParallelModules&#39;</span><span class="p">:</span><span class="n">var</span><span class="o">.</span><span class="n">ParallelModules</span><span class="p">,</span>
            <span class="s">&#39;latitude&#39;</span><span class="p">:</span><span class="n">var</span><span class="o">.</span><span class="n">TMYmeta</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
            <span class="s">&#39;longitude&#39;</span><span class="p">:</span><span class="n">var</span><span class="o">.</span><span class="n">TMYmeta</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
            <span class="s">&#39;TZ&#39;</span><span class="p">:</span><span class="n">var</span><span class="o">.</span><span class="n">TMYmeta</span><span class="o">.</span><span class="n">TZ</span><span class="p">,</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span><span class="n">var</span><span class="o">.</span><span class="n">TMYmeta</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span>
            <span class="s">&#39;altitude&#39;</span><span class="p">:</span><span class="n">var</span><span class="o">.</span><span class="n">TMYmeta</span><span class="o">.</span><span class="n">altitude</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">pvl_tools</span><span class="o">.</span><span class="n">repack</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">ashraeiam</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">theta</span><span class="p">):</span></div>
<div class="viewcode-block" id="ashraeiam"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.ashraeiam.html#pvlib.pvsystem.ashraeiam">[docs]</a>    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Determine the incidence angle modifier using the ASHRAE transmission model.</span>


<span class="sd">    pvl_ashraeiam calculates the incidence angle modifier as developed in</span>
<span class="sd">    [1], and adopted by ASHRAE (American Society of Heating, Refrigeration,</span>
<span class="sd">    and Air Conditioning Engineers) [2]. The model has been used by model</span>
<span class="sd">    programs such as PVSyst [3].</span>

<span class="sd">    Note: For incident angles near 90 degrees, this model has a</span>
<span class="sd">    discontinuity which has been addressed in this function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    b : float</span>
<span class="sd">            A parameter to adjust the modifier as a function of angle of</span>
<span class="sd">            incidence. Typical values are on the order of 0.05 [3].</span>
<span class="sd">    theta : DataFrame</span>
<span class="sd">            The angle of incidence between the module normal vector and the</span>
<span class="sd">            sun-beam vector in degrees. Theta must be a numeric scalar or vector.</span>
<span class="sd">            For any values of theta where abs(theta)&gt;90, IAM is set to 0. For any</span>
<span class="sd">            values of theta where -90 &lt; theta &lt; 0, theta is set to abs(theta) and</span>
<span class="sd">            evaluated. A warning will be generated if any(theta&lt;0 or theta&gt;90).</span>
<span class="sd">            For values of theta near 90 degrees, the ASHRAE model may be above 1</span>
<span class="sd">            or less than 0 due to the discontinuity of secant(theta). IAM values</span>
<span class="sd">            outside of [0,1] are set to 0 and a warning is generated.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    IAM : DataFrame</span>

<span class="sd">        The incident angle modifier calculated as 1-b*(sec(theta)-1) as</span>
<span class="sd">        described in [2,3]. IAM is a column vector with the same number of </span>
<span class="sd">        elements as the largest input vector.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    [1] Souka A.F., Safwat H.H., &quot;Determindation of the optimum orientations</span>
<span class="sd">    for the double exposure flat-plate collector and its reflections&quot;.</span>
<span class="sd">    Solar Energy vol .10, pp 170-174. 1966.</span>

<span class="sd">    [2] ASHRAE standard 93-77</span>

<span class="sd">    [3] PVsyst Contextual Help. </span>
<span class="sd">    http://files.pvsyst.com/help/index.html?iam_loss.htm retrieved on</span>
<span class="sd">    September 10, 2012</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    pvl_getaoi</span>
<span class="sd">    pvl_ephemeris</span>
<span class="sd">    pvl_spa  </span>
<span class="sd">    pvl_physicaliam</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>
    <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;b&#39;</span><span class="p">:</span><span class="s">&#39;x &gt;= 0&#39;</span><span class="p">,</span>
            <span class="s">&#39;theta&#39;</span><span class="p">:</span><span class="s">&#39;num&#39;</span><span class="p">}</span>
    <span class="n">var</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">)):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Input incident angles &lt;0 or &gt;=90 detected For input angles with absolute value greater than 90, the &#39;</span> <span class="o">+</span> <span class="s">&#39;modifier is set to 0. For input angles between -90 and 0, the &#39;</span> <span class="o">+</span> <span class="s">&#39;angle is changed to its absolute value and evaluated.&#39;</span><span class="p">)</span>
        <span class="n">var</span><span class="o">.</span><span class="n">theta</span><span class="p">[(</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">)]</span><span class="o">=</span><span class="nb">abs</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">))</span>

    <span class="n">IAM</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">var</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">IAM</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">IAM</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">IAM</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;It seems that we have encountered a discontinuity. Any incident angle modifiers calculated to be less than 0 or &#39;</span> <span class="o">+</span> <span class="s">&#39;greather than 1 have been set to 0.&#39;</span><span class="p">)</span>
    <span class="n">IAM</span><span class="p">[((</span><span class="n">IAM</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">IAM</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))]</span><span class="o">=</span><span class="mi">0</span>

    <span class="k">return</span> <span class="n">IAM</span>

<span class="k">def</span> <span class="nf">physicaliam</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">theta</span><span class="p">):</span></div>
<div class="viewcode-block" id="physicaliam"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.physicaliam.html#pvlib.pvsystem.physicaliam">[docs]</a>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Determine the incidence angle modifier using refractive </span>
<span class="sd">    index, glazing thickness, and extinction coefficient</span>

<span class="sd">    pvl_physicaliam calculates the incidence angle modifier as described in</span>
<span class="sd">    De Soto et al. &quot;Improvement and validation of a model for photovoltaic</span>
<span class="sd">    array performance&quot;, section 3. The calculation is based upon a physical</span>
<span class="sd">    model of absorbtion and transmission through a cover. Required</span>
<span class="sd">    information includes, incident angle, cover extinction coefficient,</span>
<span class="sd">    cover thickness</span>

<span class="sd">    Note: The authors of this function believe that eqn. 14 in [1] is</span>
<span class="sd">    incorrect. This function uses the following equation in its place:</span>
<span class="sd">    theta_r = arcsin(1/n * sin(theta))</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    K : float</span>

<span class="sd">            The glazing extinction coefficient in units of 1/meters. Reference</span>
<span class="sd">            [1] indicates that a value of  4 is reasonable for &quot;water white&quot;</span>
<span class="sd">            glass. K must be a numeric scalar or vector with all values &gt;=0. If K</span>
<span class="sd">            is a vector, it must be the same size as all other input vectors.</span>

<span class="sd">    L : float</span>

<span class="sd">            The glazing thickness in units of meters. Reference [1] indicates</span>
<span class="sd">            that 0.002 meters (2 mm) is reasonable for most glass-covered</span>
<span class="sd">            PV panels. L must be a numeric scalar or vector with all values &gt;=0. </span>
<span class="sd">            If L is a vector, it must be the same size as all other input vectors.</span>

<span class="sd">    n : float</span>

<span class="sd">            The effective index of refraction (unitless). Reference [1]</span>
<span class="sd">            indicates that a value of 1.526 is acceptable for glass. n must be a </span>
<span class="sd">            numeric scalar or vector with all values &gt;=0. If n is a vector, it </span>
<span class="sd">            must be the same size as all other input vectors.</span>

<span class="sd">    theta :float</span>

<span class="sd">            The angle of incidence between the module normal vector and the</span>
<span class="sd">            sun-beam vector in degrees. Theta must be a numeric scalar or vector.</span>
<span class="sd">            For any values of theta where abs(theta)&gt;90, IAM is set to 0. For any</span>
<span class="sd">            values of theta where -90 &lt; theta &lt; 0, theta is set to abs(theta) and</span>
<span class="sd">            evaluated. A warning will be generated if any(theta&lt;0 or theta&gt;90).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    IAM : float</span>

<span class="sd">       The incident angle modifier as specified in eqns. 14-16 of [1].</span>
<span class="sd">         IAM is a column vector with the same number of elements as the</span>
<span class="sd">         largest input vector.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    [1] W. De Soto et al., &quot;Improvement and validation of a model for</span>
<span class="sd">     photovoltaic array performance&quot;, Solar Energy, vol 80, pp. 78-88,</span>
<span class="sd">     2006.</span>

<span class="sd">    [2] Duffie, John A. &amp; Beckman, William A.. (2006). Solar Engineering </span>
<span class="sd">     of Thermal Processes, third edition. [Books24x7 version] Available </span>
<span class="sd">     from http://common.books24x7.com/toc.aspx?bookid=17160. </span>

<span class="sd">    See Also </span>
<span class="sd">    --------</span>
<span class="sd">          </span>
<span class="sd">    pvl_getaoi   </span>
<span class="sd">    pvl_ephemeris   </span>
<span class="sd">    pvl_spa    </span>
<span class="sd">    pvl_ashraeiam</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>

    <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;K&#39;</span><span class="p">:</span><span class="s">&#39;x &gt;= 0&#39;</span><span class="p">,</span>
            <span class="s">&#39;L&#39;</span><span class="p">:</span><span class="s">&#39;x &gt;= 0&#39;</span><span class="p">,</span>
            <span class="s">&#39;n&#39;</span><span class="p">:</span><span class="s">&#39;x &gt;= 0&#39;</span><span class="p">,</span>
            <span class="s">&#39;theta&#39;</span><span class="p">:</span><span class="s">&#39;num&#39;</span><span class="p">}</span>
    <span class="n">var</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>



    <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">)):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Input incident angles &lt;0 or &gt;=90 detected For input angles with absolute value greater than 90, the &#39;</span> <span class="o">+</span> <span class="s">&#39;modifier is set to 0. For input angles between -90 and 0, the &#39;</span> <span class="o">+</span> <span class="s">&#39;angle is changed to its absolute value and evaluated.&#39;</span><span class="p">)</span>
        <span class="n">var</span><span class="o">.</span><span class="n">theta</span><span class="p">[(</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">)]</span><span class="o">=</span><span class="nb">abs</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="mi">90</span><span class="p">))</span>

    <span class="n">thetar_deg</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">asind</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">sind</span><span class="p">(</span><span class="n">theta</span><span class="p">)))</span>

    <span class="n">tau</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">K</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">/</span> <span class="n">pvl_tools</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">thetar_deg</span><span class="p">)))</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((((</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">sind</span><span class="p">(</span><span class="n">thetar_deg</span> <span class="o">-</span> <span class="n">theta</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">sind</span><span class="p">(</span><span class="n">thetar_deg</span> <span class="o">+</span> <span class="n">theta</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">thetar_deg</span> <span class="o">-</span> <span class="n">theta</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">thetar_deg</span> <span class="o">+</span> <span class="n">theta</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))))</span>
    
    <span class="n">zeroang</span><span class="o">=</span><span class="mf">1e-06</span>
    
    <span class="n">thetar_deg0</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">asind</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">sind</span><span class="p">(</span><span class="n">zeroang</span><span class="p">)))</span>
    
    <span class="n">tau0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">K</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">/</span> <span class="n">pvl_tools</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">thetar_deg0</span><span class="p">)))</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((((</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">sind</span><span class="p">(</span><span class="n">thetar_deg0</span> <span class="o">-</span> <span class="n">zeroang</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">sind</span><span class="p">(</span><span class="n">thetar_deg0</span> <span class="o">+</span> <span class="n">zeroang</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">thetar_deg0</span> <span class="o">-</span> <span class="n">zeroang</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">thetar_deg0</span> <span class="o">+</span> <span class="n">zeroang</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))))</span>
    
    <span class="n">IAM</span><span class="o">=</span><span class="n">tau</span> <span class="o">/</span> <span class="n">tau0</span>
    
    <span class="n">IAM</span><span class="p">[</span><span class="n">theta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    
    <span class="n">IAM</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="o">|</span> <span class="p">(</span><span class="n">IAM</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="k">return</span> <span class="n">IAM</span>




<span class="k">def</span> <span class="nf">calcparams_desoto</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">Tcell</span><span class="p">,</span> <span class="n">alpha_isc</span><span class="p">,</span> <span class="n">ModuleParameters</span><span class="p">,</span> <span class="n">EgRef</span><span class="p">,</span> <span class="n">dEgdT</span><span class="p">,</span></div>
<div class="viewcode-block" id="calcparams_desoto"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.calcparams_desoto.html#pvlib.pvsystem.calcparams_desoto">[docs]</a>                          <span class="n">M</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Sref</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">Tref</span><span class="o">=</span><span class="mi">25</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Applies the temperature and irradiance corrections to inputs for pvl_singlediode</span>

<span class="sd">    Applies the temperature and irradiance corrections to the IL, I0,</span>
<span class="sd">    Rs, Rsh, and a parameters at reference conditions (IL_ref, I0_ref,</span>
<span class="sd">    etc.) according to the De Soto et. al description given in [1]. The</span>
<span class="sd">    results of this correction procedure may be used in a single diode</span>
<span class="sd">    model to determine IV curves at irradiance = S, cell temperature =</span>
<span class="sd">    Tcell.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    S : float or DataFrame</span>
<span class="sd">          The irradiance (in W/m^2) absorbed by the module. S must be &gt;= 0.</span>
<span class="sd">          Due to a division by S in the script, any S value equal to 0 will be set to 1E-10.</span>

<span class="sd">    Tcell : float or DataFrame</span>
<span class="sd">          The average cell temperature of cells within a module in C.</span>
<span class="sd">          Tcell must be &gt;= -273.15.</span>

<span class="sd">    alpha_isc : float</span>

<span class="sd">          The short-circuit current temperature coefficient of the module in units of 1/C.</span>

<span class="sd">    ModuleParameters : struct</span>
<span class="sd">          parameters describing PV module performance at reference conditions according</span>
<span class="sd">          to DeSoto&#39;s paper. Parameters may be generated or found by lookup. For ease of use,</span>
<span class="sd">          PVL_RETREIVESAM can automatically generate a struct based on the most recent SAM CEC module</span>
<span class="sd">          database. The ModuleParameters struct must contain (at least) the</span>
<span class="sd">          following 5 fields:</span>

<span class="sd">              *ModuleParameters.a_ref* - modified diode ideality factor parameter at</span>
<span class="sd">                  reference conditions (units of eV), a_ref can be calculated from the</span>
<span class="sd">                  usual diode ideality factor (n), number of cells in series (Ns),</span>
<span class="sd">                  and cell temperature (Tcell) per equation (2) in [1].</span>

<span class="sd">              *ModuleParameters.IL_ref* - Light-generated current (or photocurrent)</span>
<span class="sd">                  in amperes at reference conditions. This value is referred to</span>
<span class="sd">                  as Iph in some literature.</span>

<span class="sd">              *ModuleParameters.I0_ref* - diode reverse saturation current in amperes,</span>
<span class="sd">                  under reference conditions.</span>

<span class="sd">              *ModuleParameters.Rsh_ref* - shunt resistance under reference conditions (ohms)</span>

<span class="sd">              *ModuleParameters.Rs_ref* - series resistance under reference conditions (ohms)</span>

<span class="sd">    EgRef : float</span>

<span class="sd">          The energy bandgap at reference temperature (in eV). 1.121 eV for silicon. EgRef must be &gt;0.</span>

<span class="sd">    dEgdT : float</span>

<span class="sd">          The temperature dependence of the energy bandgap at SRC (in 1/C).</span>
<span class="sd">          May be either a scalar value (e.g. -0.0002677 as in [1]) or a</span>
<span class="sd">          DataFrame of dEgdT values corresponding to each input condition (this</span>
<span class="sd">          may be useful if dEgdT is a function of temperature).</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>

<span class="sd">    M : float or DataFrame (optional, Default=1)</span>
<span class="sd">          An optional airmass modifier, if omitted, M is given a value of 1,</span>
<span class="sd">          which assumes absolute (pressure corrected) airmass = 1.5. In this</span>
<span class="sd">          code, M is equal to M/Mref as described in [1] (i.e. Mref is assumed</span>
<span class="sd">          to be 1). Source [1] suggests that an appropriate value for M</span>
<span class="sd">          as a function absolute airmass (AMa) may be:</span>

<span class="sd">          &gt;&gt;&gt; M = np.polyval([-0.000126, 0.002816, -0.024459, 0.086257, 0.918093], AMa)</span>

<span class="sd">          M may be a DataFrame.</span>

<span class="sd">    Sref : float (optional, Default=1000)</span>

<span class="sd">          Optional reference irradiance in W/m^2. If omitted, a value of</span>
<span class="sd">          1000 is used.</span>

<span class="sd">    Tref : float (Optional, Default=25)</span>
<span class="sd">          Optional reference cell temperature in C. If omitted, a value of</span>
<span class="sd">          25 C is used.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    IL : float or DataFrame</span>
<span class="sd">          Light-generated current in amperes at irradiance=S and</span>
<span class="sd">          cell temperature=Tcell.</span>
<span class="sd">    I0 : float or DataFrame</span>
<span class="sd">          Diode saturation curent in amperes at irradiance S and cell temperature Tcell.</span>

<span class="sd">    Rs : float</span>
<span class="sd">          Series resistance in ohms at irradiance S and cell temperature Tcell.</span>

<span class="sd">    Rsh : float or DataFrame</span>
<span class="sd">          Shunt resistance in ohms at irradiance S and cell temperature Tcell.</span>

<span class="sd">    nNsVth : float or DataFrame</span>
<span class="sd">          Modified diode ideality factor at irradiance S and cell temperature</span>
<span class="sd">          Tcell. Note that in source [1] nNsVth = a (equation 2). nNsVth is the</span>
<span class="sd">          product of the usual diode ideality factor (n), the number of</span>
<span class="sd">          series-connected cells in the module (Ns), and the thermal voltage</span>
<span class="sd">          of a cell in the module (Vth) at a cell temperature of Tcell.</span>



<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    [1] W. De Soto et al., &quot;Improvement and validation of a model for</span>
<span class="sd">       photovoltaic array performance&quot;, Solar Energy, vol 80, pp. 78-88,</span>
<span class="sd">       2006.</span>

<span class="sd">    [2] System Advisor Model web page. https://sam.nrel.gov.</span>

<span class="sd">    [3] A. Dobos, &quot;An Improved Coefficient Calculator for the California</span>
<span class="sd">       Energy Commission 6 Parameter Photovoltaic Module Model&quot;, Journal of</span>
<span class="sd">       Solar Energy Engineering, vol 134, 2012.</span>

<span class="sd">    [4] O. Madelung, &quot;Semiconductors: Data Handbook, 3rd ed.&quot; ISBN</span>
<span class="sd">       3-540-40488-0</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    pvl_sapm</span>
<span class="sd">    pvl_sapmcelltemp</span>
<span class="sd">    pvl_singlediode</span>
<span class="sd">    pvl_retreivesam</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    If the reference parameters in the ModuleParameters struct are read</span>
<span class="sd">    from a database or library of parameters (e.g. System Advisor Model),</span>
<span class="sd">    it is important to use the same EgRef and dEgdT values that</span>
<span class="sd">    were used to generate the reference parameters, regardless of the</span>
<span class="sd">    actual bandgap characteristics of the semiconductor. For example, in</span>
<span class="sd">    the case of the System Advisor Model library, created as described in</span>
<span class="sd">    [3], EgRef and dEgdT for all modules were 1.121 and -0.0002677,</span>
<span class="sd">    respectively.</span>

<span class="sd">    This table of reference bandgap energies (EgRef), bandgap energy</span>
<span class="sd">    temperature dependence (dEgdT), and &quot;typical&quot; airmass response (M) is</span>
<span class="sd">    provided purely as reference to those who may generate their own</span>
<span class="sd">    reference module parameters (a_ref, IL_ref, I0_ref, etc.) based upon the</span>
<span class="sd">    various PV semiconductors. Again, we stress the importance of</span>
<span class="sd">    using identical EgRef and dEgdT when generation reference</span>
<span class="sd">    parameters and modifying the reference parameters (for irradiance,</span>
<span class="sd">    temperature, and airmass) per DeSoto&#39;s equations.</span>

<span class="sd">     Silicon (Si):</span>
<span class="sd">         EgRef = 1.121</span>
<span class="sd">         dEgdT = -0.0002677</span>

<span class="sd">         &gt;&gt;&gt; M = polyval([-0.000126 0.002816 -0.024459 0.086257 0.918093], AMa)</span>

<span class="sd">         Source = Reference 1</span>

<span class="sd">     Cadmium Telluride (CdTe):</span>
<span class="sd">         EgRef = 1.475</span>
<span class="sd">         dEgdT = -0.0003</span>

<span class="sd">         &gt;&gt;&gt; M = polyval([-2.46E-5 9.607E-4 -0.0134 0.0716 0.9196], AMa)</span>

<span class="sd">         Source = Reference 4</span>

<span class="sd">     Copper Indium diSelenide (CIS):</span>
<span class="sd">         EgRef = 1.010</span>
<span class="sd">         dEgdT = -0.00011</span>

<span class="sd">         &gt;&gt;&gt; M = polyval([-3.74E-5 0.00125 -0.01462 0.0718 0.9210], AMa)</span>

<span class="sd">         Source = Reference 4</span>

<span class="sd">     Copper Indium Gallium diSelenide (CIGS):</span>
<span class="sd">         EgRef = 1.15</span>
<span class="sd">         dEgdT = ????</span>

<span class="sd">         &gt;&gt;&gt; M = polyval([-9.07E-5 0.0022 -0.0202 0.0652 0.9417], AMa)</span>

<span class="sd">         Source = Wikipedia</span>

<span class="sd">     Gallium Arsenide (GaAs):</span>

<span class="sd">         EgRef = 1.424</span>
<span class="sd">         dEgdT = -0.000433</span>
<span class="sd">         M = unknown</span>
<span class="sd">         Source = Reference 4</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>

    <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;S&#39;</span><span class="p">:(</span><span class="s">&#39;x &gt;= 0&#39;</span><span class="p">)</span> <span class="p">,</span>
            <span class="s">&#39;Tcell&#39;</span><span class="p">:(</span><span class="s">&#39;x &gt;= - 273.15&#39;</span><span class="p">)</span> <span class="p">,</span>
            <span class="s">&#39;alpha_isc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="s">&#39;ModuleParameters&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="s">&#39;EgRef&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;x &gt; 0&#39;</span><span class="p">),</span>
            <span class="s">&#39;dEgdT&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="s">&#39;M&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;num&#39;</span><span class="p">,</span><span class="s">&#39;default&#39;</span><span class="p">,</span><span class="s">&#39;default=1&#39;</span><span class="p">),</span>
            <span class="s">&#39;Sref&#39;</span><span class="p">:(</span><span class="s">&#39;default&#39;</span><span class="p">,</span><span class="s">&#39;default=1000&#39;</span><span class="p">),</span>
            <span class="s">&#39;Tref&#39;</span><span class="p">:(</span><span class="s">&#39;default&#39;</span><span class="p">,</span><span class="s">&#39;default=25&#39;</span><span class="p">)</span>
            <span class="p">}</span>

    <span class="n">var</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>

    <span class="n">var</span><span class="o">.</span><span class="n">M</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">a_ref</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">ModuleParameters</span><span class="o">.</span><span class="n">A_ref</span>
    <span class="n">IL_ref</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">ModuleParameters</span><span class="o">.</span><span class="n">I_l_ref</span>
    <span class="n">I0_ref</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">ModuleParameters</span><span class="o">.</span><span class="n">I_o_ref</span>
    <span class="n">Rsh_ref</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">ModuleParameters</span><span class="o">.</span><span class="n">R_sh_ref</span>
    <span class="n">Rs_ref</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">ModuleParameters</span><span class="o">.</span><span class="n">R_s</span>


    <span class="n">k</span><span class="o">=</span><span class="mf">8.617332478e-05</span>
    <span class="n">Tref_K</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Tref</span> <span class="o">+</span> <span class="mf">273.15</span>
    <span class="n">Tcell_K</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Tcell</span> <span class="o">+</span> <span class="mf">273.15</span>

    <span class="n">var</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">S</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mf">1e-10</span>
    <span class="n">E_g</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">EgRef</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">dEgdT</span><span class="o">*</span><span class="p">((</span><span class="n">Tcell_K</span> <span class="o">-</span> <span class="n">Tref_K</span><span class="p">))))</span>

    <span class="n">nNsVth</span><span class="o">=</span><span class="n">a_ref</span><span class="o">*</span><span class="p">((</span><span class="n">Tcell_K</span> <span class="o">/</span> <span class="n">Tref_K</span><span class="p">))</span>

    <span class="n">IL</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">S</span> <span class="o">/</span> <span class="n">var</span><span class="o">.</span><span class="n">Sref</span> <span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">M</span><span class="p">)</span> <span class="o">*</span><span class="p">((</span><span class="n">IL_ref</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">alpha_isc</span> <span class="o">*</span> <span class="p">((</span><span class="n">Tcell_K</span> <span class="o">-</span> <span class="n">Tref_K</span><span class="p">))))</span>
    <span class="n">I0</span><span class="o">=</span><span class="n">I0_ref</span> <span class="o">*</span> <span class="p">(((</span><span class="n">Tcell_K</span> <span class="o">/</span> <span class="n">Tref_K</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">EgRef</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">Tref_K</span><span class="p">)))</span> <span class="o">-</span> <span class="p">(</span><span class="n">E_g</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">Tcell_K</span><span class="p">)))))</span>
    <span class="n">Rsh</span><span class="o">=</span><span class="n">Rsh_ref</span> <span class="o">*</span> <span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Sref</span> <span class="o">/</span> <span class="n">var</span><span class="o">.</span><span class="n">S</span><span class="p">))</span>
    <span class="n">Rs</span><span class="o">=</span><span class="n">Rs_ref</span>

    <span class="k">return</span> <span class="n">IL</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">Rs</span><span class="p">,</span><span class="n">Rsh</span><span class="p">,</span><span class="n">nNsVth</span>

<span class="k">def</span> <span class="nf">getaoi</span><span class="p">(</span><span class="n">SurfTilt</span><span class="p">,</span><span class="n">SurfAz</span><span class="p">,</span><span class="n">SunZen</span><span class="p">,</span><span class="n">SunAz</span><span class="p">):</span></div>
<div class="viewcode-block" id="getaoi"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.getaoi.html#pvlib.pvsystem.getaoi">[docs]</a>  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Determine angle of incidence from surface tilt/azimuth and apparent sun zenith/azimuth </span>

<span class="sd">  The surface is defined by its tilt angle from horizontal and its azimuth pointing angle. </span>
<span class="sd">  The sun position is defined by the apparent (refraction corrected)sun zenith angle and the sun </span>
<span class="sd">  azimuth angle.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  SurfTilt :  scalar or DataFrame of surface tilt angles in decimal degrees</span>

<span class="sd">               If SurfTilt is a DataFrame it must be of the same size as all other DataFrame</span>
<span class="sd">               inputs. SurfTilt must be &gt;=0 and &lt;=180. The tilt angle is defined as</span>
<span class="sd">               degrees from horizontal (e.g. surface facing up = 0, surface facing</span>
<span class="sd">               horizon = 90)</span>

<span class="sd">  SurfAz :  scalar or DataFrame of the surface azimuth angles in decimal degrees</span>

<span class="sd">               If SurfAz is a DataFrame it must be of the same size as all other DataFrame</span>
<span class="sd">               inputs. SurfAz must be &gt;=0 and &lt;=360. The Azimuth convention is defined</span>
<span class="sd">               as degrees east of north (e.g. North = 0, East = 90, West = 270).</span>

<span class="sd">  SunZen : scalar or DataFrame of apparent (refraction-corrected) zenith angles in decimal degrees. </span>

<span class="sd">               If SunZen is a DataFrame it must be of the same size as all other DataFrame </span>
<span class="sd">               inputs. SunZen must be &gt;=0 and &lt;=180.</span>

<span class="sd">  SunAz : scalar or DataFrame of sun azimuth angles in decimal degrees</span>

<span class="sd">               If SunAz is a DataFrame it must be of the same size as all other DataFrame</span>
<span class="sd">               inputs. SunAz must be &gt;=0 and &lt;=360. The Azimuth convention is defined</span>
<span class="sd">               as degrees east of north (e.g. North = 0, East = 90, West = 270).</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  AOI : DataFrame</span>
<span class="sd">      The angle, in decimal degrees, between the surface normal DataFrame and the sun beam DataFrame. </span>

<span class="sd">  References</span>
<span class="sd">  ----------</span>
<span class="sd">  D.L. King, J.A. Kratochvil, W.E. Boyson. &quot;Spectral and</span>
<span class="sd">  Angle-of-Incidence Effects on Photovoltaic Modules and Solar Irradiance</span>
<span class="sd">  Sensors&quot;. 26th IEEE Photovoltaic Specialists Conference. Sept. 1997.</span>

<span class="sd">  See Also</span>
<span class="sd">  --------</span>
<span class="sd">  PVL_EPHEMERIS</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>
  <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;SurfTilt&#39;</span><span class="p">:(</span><span class="s">&#39;num&#39;</span><span class="p">,</span><span class="s">&#39;x&gt;=0&#39;</span><span class="p">),</span>
        <span class="s">&#39;SurfAz&#39;</span><span class="p">:(</span><span class="s">&#39;num&#39;</span><span class="p">,</span><span class="s">&#39;x&gt;=-180&#39;</span><span class="p">,</span><span class="s">&#39;x&lt;=180&#39;</span><span class="p">),</span>
        <span class="s">&#39;SunZen&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;=0&#39;</span><span class="p">),</span>
        <span class="s">&#39;SunAz&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;=0&#39;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="n">var</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>

  <span class="n">AOI</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">SunZen</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">SurfTilt</span><span class="p">)))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">SurfTilt</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">SunZen</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">SunAz</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">SurfAz</span><span class="p">)))))</span> <span class="c">#Duffie and Beckmann 1.6.3</span>


  <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">&#39;AOI&#39;</span><span class="p">:</span><span class="n">AOI</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">retreiveSAM</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">FileLoc</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">):</span></div>
<div class="viewcode-block" id="retreiveSAM"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.retreiveSAM.html#pvlib.pvsystem.retreiveSAM">[docs]</a>    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Retreive lastest module and inverter info from SAM website</span>

<span class="sd">    PVL_RETREIVESAM Retreive lastest module and inverter info from SAM website.</span>
<span class="sd">    This function will retreive either:</span>

<span class="sd">        * CEC module database</span>
<span class="sd">        * Sandia Module database</span>
<span class="sd">        * Sandia Inverter database</span>

<span class="sd">    and export it as a pandas dataframe</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    name: String</span>
<span class="sd">                Name can be one of:</span>

<span class="sd">                * &#39;CECMod&#39;- returns the CEC module database</span>
<span class="sd">                * &#39;SandiaInverter- returns the Sandia Inverter database</span>
<span class="sd">                * &#39;SandiaMod&#39;- returns the Sandia Module database</span>
<span class="sd">    FileLoc: String</span>

<span class="sd">                Absolute path to the location of local versions of the SAM file. </span>
<span class="sd">                If FileLoc is specified, the latest versions of the SAM database will</span>
<span class="sd">                not be downloaded. The selected file must be in .csv format. </span>

<span class="sd">                If set to &#39;select&#39;, a dialogue will open allowing the suer to navigate </span>
<span class="sd">                to the appropriate page. </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    df: DataFrame</span>

<span class="sd">                A DataFrame containing all the elements of the desired database. </span>
<span class="sd">                Each column representa a module or inverter, and a specific dataset</span>
<span class="sd">                can be retreived by the command</span>

<span class="sd">                &gt;&gt;&gt; df.module_or_inverter_name</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; Invdb=SAM.pvl_retreiveSAM(name=&#39;SandiaInverter&#39;)</span>
<span class="sd">    &gt;&gt;&gt; inverter=Invdb.AE_Solar_Energy__AE6_0__277V__277V__CEC_2012_</span>
<span class="sd">    &gt;&gt;&gt; inverter    </span>
<span class="sd">    Vac           277.000000</span>
<span class="sd">    Paco         6000.000000</span>
<span class="sd">    Pdco         6165.670000</span>
<span class="sd">    Vdco          361.123000</span>
<span class="sd">    Pso            36.792300</span>
<span class="sd">    C0             -0.000002</span>
<span class="sd">    C1             -0.000047</span>
<span class="sd">    C2             -0.001861</span>
<span class="sd">    C3              0.000721</span>
<span class="sd">    Pnt             0.070000</span>
<span class="sd">    Vdcmax        600.000000</span>
<span class="sd">    Idcmax         32.000000</span>
<span class="sd">    Mppt_low      200.000000</span>
<span class="sd">    Mppt_high     500.000000</span>
<span class="sd">    Name: AE_Solar_Energy__AE6_0__277V__277V__CEC_2012_, dtype: float64</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>
    <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:(</span><span class="s">&#39;str&#39;</span><span class="p">,(</span><span class="s">&#39;CECMod&#39;</span><span class="p">,</span><span class="s">&#39;SandiaMod&#39;</span><span class="p">,</span><span class="s">&#39;SandiaInverter&#39;</span><span class="p">)),</span>
            <span class="s">&#39;FileLoc&#39;</span><span class="p">:(</span><span class="s">&#39;optional&#39;</span><span class="p">)}</span>

    <span class="n">var</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s">&#39;CECMod&#39;</span><span class="p">:</span>
        <span class="n">url</span><span class="o">=</span><span class="s">&#39;https://sam.nrel.gov/sites/sam.nrel.gov/files/sam-library-cec-modules-2014-1-14.csv&#39;</span>
    <span class="k">elif</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s">&#39;SandiaMod&#39;</span><span class="p">:</span>
        <span class="n">url</span><span class="o">=</span><span class="s">&#39;https://sam.nrel.gov/sites/sam.nrel.gov/files/sam-library-sandia-modules-2014-1-14.csv&#39;</span>
    <span class="k">elif</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s">&#39;SandiaInverter&#39;</span><span class="p">:</span>
        <span class="n">url</span><span class="o">=</span><span class="s">&#39;https://sam.nrel.gov/sites/sam.nrel.gov/files/sam-library-sandia-inverters-2014-1-14.csv&#39;</span>
    
    <span class="k">if</span> <span class="n">FileLoc</span><span class="o">==</span><span class="s">&#39;none&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">read_url_to_pandas</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">FileLoc</span><span class="o">==</span><span class="s">&#39;select&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">Tkinter</span> 
            <span class="kn">from</span> <span class="nn">tkFileDialog</span> <span class="kn">import</span> <span class="n">askopenfilename</span>
            <span class="n">Tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>                  <span class="c">#Start interactive file input</span>
            <span class="k">return</span> <span class="n">read_relative_to_pandas</span><span class="p">(</span><span class="n">askopenfilename</span><span class="p">())</span>                               
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span> <span class="p">(</span><span class="s">&#39;Python not configured for TKinter. Try installing XQuartz and rerunning&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">read_relative_to_pandas</span><span class="p">(</span><span class="n">FileLoc</span><span class="p">)</span>
        
<span class="k">def</span> <span class="nf">read_url_to_pandas</span><span class="p">(</span><span class="n">url</span><span class="p">):</span></div>
<div class="viewcode-block" id="read_url_to_pandas"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.read_url_to_pandas.html#pvlib.pvsystem.read_url_to_pandas">[docs]</a>
    <span class="n">data</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">parsedindex</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">parsedindex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">))</span>
        
    <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">parsedindex</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">read_relative_to_pandas</span><span class="p">(</span><span class="n">FileLoc</span><span class="p">):</span></div>
<div class="viewcode-block" id="read_relative_to_pandas"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.read_relative_to_pandas.html#pvlib.pvsystem.read_relative_to_pandas">[docs]</a>
    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">FileLoc</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">parsedindex</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">parsedindex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">))</span>
        
    <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">parsedindex</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">sapm</span><span class="p">(</span><span class="n">Module</span><span class="p">,</span><span class="n">Eb</span><span class="p">,</span><span class="n">Ediff</span><span class="p">,</span><span class="n">Tcell</span><span class="p">,</span><span class="n">AM</span><span class="p">,</span><span class="n">AOI</span><span class="p">):</span></div>
<div class="viewcode-block" id="sapm"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.sapm.html#pvlib.pvsystem.sapm">[docs]</a>  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Performs Sandia PV Array Performance Model to get 5 points on IV curve given SAPM module parameters, Ee, and cell temperature</span>

<span class="sd">  The Sandia PV Array Performance Model (SAPM) generates 5 points on a PV</span>
<span class="sd">  module&#39;s I-V curve (Voc, Isc, Ix, Ixx, Vmp/Imp) according to</span>
<span class="sd">  SAND2004-3535. Assumes a reference cell temperature of 25 C.</span>
<span class="sd">  </span>
<span class="sd">  parameters</span>
<span class="sd">  ----------</span>

<span class="sd">  Module : DataFrame</span>

<span class="sd">          A DataFrame defining the SAPM performance parameters (see</span>
<span class="sd">          pvl_retreivesam)</span>

<span class="sd">  Eb : float of DataFrame</span>

<span class="sd">          The effective irradiance incident upon the module (suns). Any Ee&lt;0</span>
<span class="sd">          are set to 0.</span>
<span class="sd">  </span>
<span class="sd">  celltemp : float of DataFrame</span>
<span class="sd">          </span>
<span class="sd">          The cell temperature (degrees C)</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  Result - DataFrame</span>

<span class="sd">          A DataFrame with:</span>

<span class="sd">          * Result.Isc</span>
<span class="sd">          * Result.Imp</span>
<span class="sd">          * Result.Ix</span>
<span class="sd">          * Result.Ixx</span>
<span class="sd">          * Result.Voc</span>
<span class="sd">          * Result.Vmp</span>
<span class="sd">          * Result.Pmp</span>

<span class="sd">  Notes</span>
<span class="sd">  -----</span>

<span class="sd">  The particular coefficients from SAPM which are required in Module</span>
<span class="sd">  are:</span>
<span class="sd">  </span>
<span class="sd">  ================   ======================================================================================================================</span>
<span class="sd">  Module field        Description</span>
<span class="sd">  ================   ======================================================================================================================</span>
<span class="sd">  Module.c           1x8 vector with the C coefficients Module.c(1) = C0</span>
<span class="sd">  Module.Isc0        Short circuit current at reference condition (amps)</span>
<span class="sd">  Module.Imp0        Maximum power current at reference condition (amps)</span>
<span class="sd">  Module.AlphaIsc    Short circuit current temperature coefficient at reference condition (1/C)</span>
<span class="sd">  Module.AlphaImp    Maximum power current temperature coefficient at reference condition (1/C)</span>
<span class="sd">  Module.BetaVoc     Open circuit voltage temperature coefficient at reference condition (V/C)</span>
<span class="sd">  Module.mBetaVoc    Coefficient providing the irradiance dependence for the BetaVoc temperature coefficient at reference irradiance (V/C)</span>
<span class="sd">  Module.BetaVmp     Maximum power voltage temperature coefficient at reference condition</span>
<span class="sd">  Module.mBetaVmp    Coefficient providing the irradiance dependence for the BetaVmp temperature coefficient at reference irradiance (V/C)</span>
<span class="sd">  Module.n           Empirically determined &quot;diode factor&quot; (dimensionless)</span>
<span class="sd">  Module.Ns          Number of cells in series in a module&#39;s cell string(s)</span>
<span class="sd">  ================   ======================================================================================================================</span>
<span class="sd">  </span>
<span class="sd">  References</span>
<span class="sd">  ----------</span>

<span class="sd">  [1] King, D. et al, 2004, &quot;Sandia Photovoltaic Array Performance Model&quot;, SAND Report</span>
<span class="sd">  3535, Sandia National Laboratories, Albuquerque, NM</span>

<span class="sd">  See Also</span>
<span class="sd">  --------</span>

<span class="sd">  pvl_retreivesam</span>
<span class="sd">  pvl_sapmcelltemp </span>
<span class="sd">  </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>
  <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Module&#39;</span><span class="p">:(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
          <span class="s">&#39;Eb&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;0&#39;</span><span class="p">),</span>
          <span class="s">&#39;Ediff&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;0&#39;</span><span class="p">),</span>
          <span class="s">&#39;Tcell&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;0&#39;</span><span class="p">),</span>
          <span class="s">&#39;AM&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;0&#39;</span><span class="p">),</span>
          <span class="s">&#39;AOI&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;0&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="n">var</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>

  <span class="n">T0</span><span class="o">=</span><span class="mi">25</span>
  <span class="n">q</span><span class="o">=</span><span class="mf">1.60218e-19</span>
  <span class="n">k</span><span class="o">=</span><span class="mf">1.38066e-23</span>
  <span class="n">E0</span><span class="o">=</span><span class="mi">1000</span>

  <span class="n">AMcoeff</span><span class="o">=</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;A4&#39;</span><span class="p">],</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;A3&#39;</span><span class="p">],</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;A2&#39;</span><span class="p">],</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;A1&#39;</span><span class="p">],</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;A0&#39;</span><span class="p">]]</span>
  <span class="n">AOIcoeff</span><span class="o">=</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;B5&#39;</span><span class="p">],</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;B4&#39;</span><span class="p">],</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;B3&#39;</span><span class="p">],</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;B2&#39;</span><span class="p">],</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;B1&#39;</span><span class="p">],</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;B0&#39;</span><span class="p">]]</span>

  <span class="n">F1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">AMcoeff</span><span class="p">,</span><span class="n">var</span><span class="o">.</span><span class="n">AM</span><span class="p">)</span>
  <span class="n">F2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">AOIcoeff</span><span class="p">,</span><span class="n">var</span><span class="o">.</span><span class="n">AOI</span><span class="p">)</span>
  <span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="o">=</span> <span class="n">F1</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Eb</span><span class="o">*</span><span class="n">F2</span><span class="o">+</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="p">[</span><span class="s">&#39;FD&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">var</span><span class="o">.</span><span class="n">Ediff</span><span class="p">)</span><span class="o">/</span><span class="n">E0</span><span class="p">)</span>
  <span class="c">#var[&#39;Ee&#39;]=F1*((var.Eb+var.Ediff)/E0)</span>
  <span class="c">#print &quot;Ee modifed, revert for main function&quot;</span>
  <span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>

  <span class="n">Filt</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span> <span class="o">&gt;=</span> <span class="mf">0.001</span><span class="p">]</span>

  <span class="n">Isc</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Isco&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Aisc&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Tcell</span> <span class="o">-</span> <span class="n">T0</span><span class="p">))))</span>

  <span class="n">DFOut</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">&#39;Isc&#39;</span><span class="p">:</span><span class="n">Isc</span><span class="p">})</span>

  <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Imp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Impo&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;C0&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">)</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;C1&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Aimp&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Tcell</span> <span class="o">-</span> <span class="n">T0</span><span class="p">))))</span>
  <span class="n">Bvoco</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Bvoco&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Mbvoc&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">))</span>
  <span class="n">delta</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;N&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Tcell</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">))</span> <span class="o">/</span> <span class="n">q</span>
  <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Voc&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Voco&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;#Series&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">))</span> <span class="o">+</span> <span class="n">Bvoco</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Tcell</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)))</span>
  <span class="n">Bvmpo</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Bvmpo&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Mbvmp&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">))</span>
  <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Vmp&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Vmpo&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;C2&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;#Series&#39;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">))</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;C3&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;#Series&#39;</span><span class="p">])</span><span class="o">*</span><span class="p">((</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">)))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">Bvmpo</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Tcell</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)))</span>
  <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Vmp&#39;</span><span class="p">][</span><span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Vmp&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
  <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Pmp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">DFOut</span><span class="o">.</span><span class="n">Imp</span><span class="o">*</span><span class="n">DFOut</span><span class="o">.</span><span class="n">Vmp</span>
  <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Ix&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;IXO&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;C4&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">)</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;C5&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Aisc&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Tcell</span> <span class="o">-</span> <span class="n">T0</span><span class="p">))))</span>
  <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Ixx&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;IXXO&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;C6&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">)</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;C7&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Ee</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s">&#39;Aisc&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Tcell</span> <span class="o">-</span> <span class="n">T0</span><span class="p">))))</span>

  <span class="k">return</span>  <span class="n">DFOut</span>


<span class="k">def</span> <span class="nf">sapmcelltemp</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">Wspd</span><span class="p">,</span> <span class="n">Tamb</span><span class="p">,</span><span class="n">modelt</span><span class="o">=</span><span class="s">&#39;Open_rack_cell_glassback&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></div>
<div class="viewcode-block" id="sapmcelltemp"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.sapmcelltemp.html#pvlib.pvsystem.sapmcelltemp">[docs]</a>  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Estimate cell temperature from irradiance, windspeed, ambient temperature, and module parameters (SAPM)</span>

<span class="sd">  Estimate cell and module temperatures per the Sandia PV Array</span>
<span class="sd">  Performance model (SAPM, SAND2004-3535), when given the incident</span>
<span class="sd">  irradiance, wind speed, ambient temperature, and SAPM module</span>
<span class="sd">  parameters.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>

<span class="sd">  E : float or DataFrame</span>
<span class="sd">          Total incident irradiance in W/m^2. Must be &gt;=0.</span>


<span class="sd">  windspeed : float or DataFrame</span>
<span class="sd">          Wind speed in m/s at a height of 10 meters. Must be &gt;=0</span>

<span class="sd">  Tamb : float or DataFrame</span>
<span class="sd">          Ambient dry bulb temperature in degrees C. Must be &gt;= -273.15.</span>


<span class="sd">  Other Parameters</span>
<span class="sd">  ----------------</span>

<span class="sd">  modelt :  string</span>

<span class="sd">  Model to be used for parameters, can be:</span>

<span class="sd">          * &#39;Open_rack_cell_glassback&#39; (DEFAULT)</span>
<span class="sd">          * &#39;Roof_mount_cell_glassback&#39;</span>
<span class="sd">          * &#39;Open_rack_cell_polymerback&#39;</span>
<span class="sd">          * &#39;Insulated_back_polumerback&#39;</span>
<span class="sd">          * &#39;Open_rack_Polymer_thinfilm_steel&#39;</span>
<span class="sd">          * &#39;22X_Concentrator_tracker&#39;</span>

<span class="sd">  a : float (optional)</span>
<span class="sd">          SAPM module parameter for establishing the upper limit for module </span>
<span class="sd">          temperature at low wind speeds and high solar irradiance (see SAPM</span>
<span class="sd">          eqn. 11). Must be a scalar.If not input, this value will be taken from the chosen</span>
<span class="sd">          model</span>
<span class="sd">  b : float (optional)</span>

<span class="sd">          SAPM module parameter for establishing the rate at which the module</span>
<span class="sd">          temperature drops as wind speed increases (see SAPM eqn. 11). Must be</span>
<span class="sd">          a scalar.If not input, this value will be taken from the chosen</span>
<span class="sd">          model</span>

<span class="sd">  deltaT : float (optional) </span>

<span class="sd">          SAPM module parameter giving the temperature difference</span>
<span class="sd">          between the cell and module back surface at the reference irradiance,</span>
<span class="sd">          E0. Must be a numeric scalar &gt;=0. If not input, this value will be taken from the chosen</span>
<span class="sd">          model</span>

<span class="sd">  Returns</span>
<span class="sd">  --------</span>
<span class="sd">  Tcell : float or DataFrame</span>
<span class="sd">          Cell temperatures in degrees C.</span>
<span class="sd">  </span>
<span class="sd">  Tmodule : float or DataFrame</span>
<span class="sd">          Module back temperature in degrees C.</span>

<span class="sd">  References</span>
<span class="sd">  ----------</span>

<span class="sd">  [1] King, D. et al, 2004, &quot;Sandia Photovoltaic Array Performance Model&quot;, SAND Report</span>
<span class="sd">  3535, Sandia National Laboratories, Albuquerque, NM</span>

<span class="sd">  See Also </span>
<span class="sd">  --------</span>

<span class="sd">  pvl_sapm</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>
  <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:(</span><span class="s">&#39;optional&#39;</span><span class="p">,</span><span class="s">&#39;num&#39;</span><span class="p">),</span>
          <span class="s">&#39;b&#39;</span><span class="p">:(</span><span class="s">&#39;optional&#39;</span><span class="p">,</span><span class="s">&#39;num&#39;</span><span class="p">),</span>
          <span class="s">&#39;deltaT&#39;</span><span class="p">:(</span><span class="s">&#39;optional&#39;</span><span class="p">,</span><span class="s">&#39;num&#39;</span><span class="p">),</span> 
          <span class="s">&#39;E&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;=0&#39;</span><span class="p">),</span>
          <span class="s">&#39;Wspd&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;=0&#39;</span><span class="p">),</span>
          <span class="s">&#39;Tamb&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;=0&#39;</span><span class="p">),</span>
          <span class="s">&#39;modelt&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">,</span><span class="s">&#39;default=Open_rack_cell_glassback&#39;</span><span class="p">)</span>
          <span class="p">}</span>

  <span class="n">var</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>

  <span class="n">TempModel</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Open_rack_cell_glassback&#39;</span><span class="p">:[</span><span class="o">-</span><span class="mf">3.47</span><span class="p">,</span> <span class="o">-.</span><span class="mo">05</span><span class="mi">94</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
              <span class="s">&#39;Roof_mount_cell_glassback&#39;</span><span class="p">:[</span><span class="o">-</span><span class="mf">2.98</span><span class="p">,</span> <span class="o">-.</span><span class="mo">0471</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
              <span class="s">&#39;Open_rack_cell_polymerback&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">3.56</span><span class="p">,</span> <span class="o">-.</span><span class="mo">0750</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
              <span class="s">&#39;Insulated_back_polumerback&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.81</span><span class="p">,</span> <span class="o">-.</span><span class="mo">0455</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span>
              <span class="s">&#39;Open_rack_Polymer_thinfilm_steel&#39;</span><span class="p">:[</span><span class="o">-</span><span class="mf">3.58</span><span class="p">,</span> <span class="o">-.</span><span class="mi">113</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
              <span class="s">&#39;22X_Concentrator_tracker&#39;</span><span class="p">:[</span><span class="o">-</span><span class="mf">3.23</span><span class="p">,</span> <span class="o">-.</span><span class="mi">130</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
          <span class="p">}</span>
  <span class="k">try</span><span class="p">:</span> 
      <span class="n">a</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">a</span>
      <span class="n">b</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">b</span>
      <span class="n">deltaT</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">deltaT</span>
  <span class="k">except</span><span class="p">:</span>
      <span class="n">a</span><span class="o">=</span><span class="n">TempModel</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">modelt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">b</span><span class="o">=</span><span class="n">TempModel</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">modelt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">deltaT</span><span class="o">=</span><span class="n">TempModel</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">modelt</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

  <span class="n">E0</span><span class="o">=</span><span class="mi">1000</span> <span class="c"># Reference irradiance</span>

  <span class="n">Tmodule</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">E</span><span class="o">*</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">var</span><span class="o">.</span><span class="n">Wspd</span><span class="p">)))</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">Tamb</span>

  <span class="n">Tcell</span><span class="o">=</span><span class="n">Tmodule</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">E</span> <span class="o">/</span> <span class="n">E0</span><span class="o">*</span><span class="p">(</span><span class="n">deltaT</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">&#39;Tcell&#39;</span><span class="p">:</span><span class="n">Tcell</span><span class="p">,</span><span class="s">&#39;Tmodule&#39;</span><span class="p">:</span><span class="n">Tmodule</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">singlediode</span><span class="p">(</span><span class="n">Module</span><span class="p">,</span><span class="n">IL</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">Rs</span><span class="p">,</span><span class="n">Rsh</span><span class="p">,</span><span class="n">nNsVth</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></div>
<div class="viewcode-block" id="singlediode"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.singlediode.html#pvlib.pvsystem.singlediode">[docs]</a>    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Solve the single-diode model to obtain a photovoltaic IV curve</span>


<span class="sd">    pvl_singlediode solves the single diode equation [1]:</span>
<span class="sd">    I = IL - I0*[exp((V+I*Rs)/(nNsVth))-1] - (V + I*Rs)/Rsh</span>
<span class="sd">    for I and V when given IL, I0, Rs, Rsh, and nNsVth (nNsVth = n*Ns*Vth) which</span>
<span class="sd">    are described later. pvl_singlediode returns a struct which contains</span>
<span class="sd">    the 5 points on the I-V curve specified in SAND2004-3535 [3]. </span>
<span class="sd">    If all IL, I0, Rs, Rsh, and nNsVth are scalar, a single curve</span>
<span class="sd">    will be returned, if any are DataFrames (of the same length), multiple IV</span>
<span class="sd">    curves will be calculated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    These imput parameters can be calculated using PVL_CALCPARAMS_DESOTO from </span>
<span class="sd">    meterological data. </span>

<span class="sd">    IL : float or DataFrame</span>
<span class="sd">                Light-generated current (photocurrent) in amperes under desired IV</span>
<span class="sd">                curve conditions. </span>

<span class="sd">    I0 : float or DataFrame</span>
<span class="sd">                Diode saturation current in amperes under desired IV curve</span>
<span class="sd">                conditions. </span>

<span class="sd">    Rs : float or DataFrame</span>
<span class="sd">                Series resistance in ohms under desired IV curve conditions. </span>

<span class="sd">    Rsh : float or DataFrame</span>
<span class="sd">                Shunt resistance in ohms under desired IV curve conditions. May</span>
<span class="sd">                be a scalar or DataFrame, but DataFrames must be of same length as all</span>
<span class="sd">                other input DataFrames.</span>

<span class="sd">    nNsVth : float or DataFrame</span>
<span class="sd">                the product of three components. 1) The usual diode ideal </span>
<span class="sd">                factor (n), 2) the number of cells in series (Ns), and 3) the cell </span>
<span class="sd">                thermal voltage under the desired IV curve conditions (Vth).</span>
<span class="sd">                The thermal voltage of the cell (in volts) may be calculated as </span>
<span class="sd">                k*Tcell/q, where k is Boltzmann&#39;s constant (J/K), Tcell is the</span>
<span class="sd">                temperature of the p-n junction in Kelvin, and q is the elementary </span>
<span class="sd">                charge of an electron (coulombs). </span>
<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>

<span class="sd">    NumPoints : integer</span>

<span class="sd">                Number of points in the desired IV curve (optional). Must be a finite </span>
<span class="sd">                scalar value. Non-integer values will be rounded to the next highest</span>
<span class="sd">                integer (ceil). If ceil(NumPoints) is &lt; 2, no IV curves will be produced</span>
<span class="sd">                (i.e. Result.V and Result.I will not be generated). The default</span>
<span class="sd">                value is 0, resulting in no calculation of IV points other than</span>
<span class="sd">                those specified in [3].</span>

<span class="sd">    Returns</span>

<span class="sd">    Result : DataFrame</span>

<span class="sd">                A DataFrame with the following fields. All fields have the</span>
<span class="sd">                same number of rows as the largest input DataFrame:</span>
<span class="sd">                </span>
<span class="sd">                * Result.Isc -  short circuit current in amperes.</span>
<span class="sd">                * Result.Voc -  open circuit voltage in volts.</span>
<span class="sd">                * Result.Imp -  current at maximum power point in amperes. </span>
<span class="sd">                * Result.Vmp -  voltage at maximum power point in volts.</span>
<span class="sd">                * Result.Pmp -  power at maximum power point in watts.</span>
<span class="sd">                * Result.Ix -  current, in amperes, at V = 0.5*Voc.</span>
<span class="sd">                * Result.Ixx -  current, in amperes, at V = 0.5*(Voc+Vmp).</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The solution employed to solve the implicit diode equation utilizes</span>
<span class="sd">    the Lambert W function to obtain an explicit function of V=f(i) and</span>
<span class="sd">    I=f(V) as shown in [2].</span>

<span class="sd">    References</span>
<span class="sd">    -----------</span>

<span class="sd">    [1] S.R. Wenham, M.A. Green, M.E. Watt, &quot;Applied Photovoltaics&quot; </span>
<span class="sd">    ISBN 0 86758 909 4</span>

<span class="sd">    [2] A. Jain, A. Kapoor, &quot;Exact analytical solutions of the parameters of </span>
<span class="sd">    real solar cells using Lambert W-function&quot;, Solar Energy Materials </span>
<span class="sd">    and Solar Cells, 81 (2004) 269-277.</span>

<span class="sd">    [3] D. King et al, &quot;Sandia Photovoltaic Array Performance Model&quot;,</span>
<span class="sd">    SAND2004-3535, Sandia National Laboratories, Albuquerque, NM</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    pvl_sapm</span>
<span class="sd">    pvl_calcparams_desoto</span>


<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>
    <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Module&#39;</span><span class="p">:(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="s">&#39;IL&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;0&#39;</span><span class="p">),</span>
            <span class="s">&#39;I0&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;0&#39;</span><span class="p">),</span>
            <span class="s">&#39;Rs&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;0&#39;</span><span class="p">),</span>
            <span class="s">&#39;Rsh&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;0&#39;</span><span class="p">),</span>
            <span class="s">&#39;nNsVth&#39;</span><span class="p">:(</span><span class="s">&#39;x&gt;0&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">var</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>

    <span class="c"># Find Isc using Lambert W</span>
    <span class="n">Isc</span> <span class="o">=</span> <span class="n">I_from_V</span><span class="p">(</span><span class="n">Rsh</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Rsh</span><span class="p">,</span> <span class="n">Rs</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Rs</span><span class="p">,</span> <span class="n">nNsVth</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">nNsVth</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">I0</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">I0</span><span class="p">,</span> <span class="n">IL</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">IL</span><span class="p">)</span>


    <span class="c">#If passed a dataframe, output a dataframe, if passed a list or scalar,</span>
    <span class="c">#return a dict </span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">Rsh</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="n">DFOut</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">&#39;Isc&#39;</span><span class="p">:</span><span class="n">Isc</span><span class="p">})</span>
        <span class="n">DFOut</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Rsh</span><span class="o">.</span><span class="n">index</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">DFOut</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Isc&#39;</span><span class="p">:</span><span class="n">Isc</span><span class="p">}</span>


    <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Rsh&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Rsh</span>
    <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Rs&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Rs</span>
    <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;nNsVth&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">nNsVth</span>
    <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;I0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">I0</span>
    <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;IL&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">IL</span>

    <span class="n">__</span><span class="p">,</span><span class="n">Voc_return</span> <span class="o">=</span> <span class="n">golden_sect_DataFrame</span><span class="p">(</span><span class="n">DFOut</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">V_oc_ref</span><span class="o">*</span><span class="mf">1.6</span><span class="p">,</span><span class="n">Voc_optfcn</span><span class="p">)</span>
    <span class="n">Voc</span><span class="o">=</span><span class="n">Voc_return</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c">#create an immutable copy </span>

    <span class="n">Pmp</span><span class="p">,</span><span class="n">Vmax</span> <span class="o">=</span> <span class="n">golden_sect_DataFrame</span><span class="p">(</span><span class="n">DFOut</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">var</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">V_oc_ref</span><span class="o">*</span><span class="mf">1.14</span><span class="p">,</span><span class="n">pwr_optfcn</span><span class="p">)</span>
    <span class="n">Imax</span> <span class="o">=</span> <span class="n">I_from_V</span><span class="p">(</span><span class="n">Rsh</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Rsh</span><span class="p">,</span> <span class="n">Rs</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Rs</span><span class="p">,</span> <span class="n">nNsVth</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">nNsVth</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="n">Vmax</span><span class="p">,</span> <span class="n">I0</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">I0</span><span class="p">,</span> <span class="n">IL</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">IL</span><span class="p">)</span>
    <span class="c"># Invert the Power-Current curve. Find the current where the inverted power</span>
    <span class="c"># is minimized. This is Imax. Start the optimization at Voc/2</span>

    <span class="c"># Find Ix and Ixx using Lambert W</span>
    <span class="n">Ix</span> <span class="o">=</span> <span class="n">I_from_V</span><span class="p">(</span><span class="n">Rsh</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Rsh</span><span class="p">,</span> <span class="n">Rs</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Rs</span><span class="p">,</span> <span class="n">nNsVth</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">nNsVth</span><span class="p">,</span> <span class="n">V</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">Voc</span><span class="p">,</span> <span class="n">I0</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">I0</span><span class="p">,</span> <span class="n">IL</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">IL</span><span class="p">)</span>
    <span class="n">Ixx</span> <span class="o">=</span> <span class="n">I_from_V</span><span class="p">(</span><span class="n">Rsh</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Rsh</span><span class="p">,</span> <span class="n">Rs</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Rs</span><span class="p">,</span> <span class="n">nNsVth</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">nNsVth</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Voc</span><span class="o">+</span><span class="n">Vmax</span><span class="p">),</span> <span class="n">I0</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">I0</span><span class="p">,</span> <span class="n">IL</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">IL</span><span class="p">)</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    # If the user says they want a curve of with number of points equal to</span>
<span class="sd">    # NumPoints (must be &gt;=2), then create a voltage array where voltage is</span>
<span class="sd">    # zero in the first column, and Voc in the last column. Number of columns</span>
<span class="sd">    # must equal NumPoints. Each row represents the voltage for one IV curve.</span>
<span class="sd">    # Then create a current array where current is Isc in the first column, and</span>
<span class="sd">    # zero in the last column, and each row represents the current in one IV</span>
<span class="sd">    # curve. Thus the nth (V,I) point of curve m would be found as follows:</span>
<span class="sd">    # (Result.V(m,n),Result.I(m,n)).</span>
<span class="sd">    if NumPoints &gt;= 2</span>
<span class="sd">       s = ones(1,NumPoints); # shaping DataFrame to shape the column DataFrame parameters into 2-D matrices</span>
<span class="sd">       Result.V = (Voc)*(0:1/(NumPoints-1):1);</span>
<span class="sd">       Result.I = I_from_V(Rsh*s, Rs*s, nNsVth*s, Result.V, I0*s, IL*s);</span>
<span class="sd">    end</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Imp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Imax</span>
    <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Voc&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Voc</span>
    <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Vmp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Vmax</span>
    <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Pmp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Pmp</span>
    <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Ix&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Ix</span>
    <span class="n">DFOut</span><span class="p">[</span><span class="s">&#39;Ixx&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Ixx</span>

    <span class="k">return</span>  <span class="n">DFOut</span>



<span class="sd">&#39;&#39;&#39;</span></div>
<span class="sd">Created April,2014</span>
<span class="sd">Author: Rob Andrews, Calama Consulting</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="k">def</span> <span class="nf">golden_sect_DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">VL</span><span class="p">,</span><span class="n">VH</span><span class="p">,</span><span class="n">func</span><span class="p">):</span>
<div class="viewcode-block" id="golden_sect_DataFrame"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.golden_sect_DataFrame.html#pvlib.pvsystem.golden_sect_DataFrame">[docs]</a>    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Vectorized golden section search for finding MPPT from a dataframe timeseries</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    df : DataFrame</span>

<span class="sd">            Dataframe containing a timeseries of inputs to the function to be optimized.</span>
<span class="sd">            Each row should represent an independant optimization</span>

<span class="sd">    VL: float</span>
<span class="sd">            low bound of the optimization</span>

<span class="sd">    VH: float</span>
<span class="sd">            Uppoer bound of the optimization</span>

<span class="sd">    func: function</span>
<span class="sd">            function to be optimized must be in the form f(dataframe,x)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    func(df,&#39;V1&#39;) : DataFrame</span>
<span class="sd">            function evaluated at the optimal point</span>

<span class="sd">    df[&#39;V1&#39;]: Dataframe</span>
<span class="sd">            Dataframe of optimal points</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This funtion will find the MAXIMUM of a function</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">df</span><span class="p">[</span><span class="s">&#39;VH&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">VH</span>
    <span class="n">df</span><span class="p">[</span><span class="s">&#39;VL&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">VL</span>

    <span class="n">err</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;VH&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;VL&#39;</span><span class="p">]</span>
    <span class="n">errflag</span><span class="o">=</span><span class="bp">True</span>
    <span class="n">iterations</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span> <span class="n">errflag</span><span class="p">:</span>

        <span class="n">phi</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;VH&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;VL&#39;</span><span class="p">])</span>
        <span class="n">df</span><span class="p">[</span><span class="s">&#39;V1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;VL&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">phi</span>
        <span class="n">df</span><span class="p">[</span><span class="s">&#39;V2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;VH&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">phi</span>
        
        <span class="n">df</span><span class="p">[</span><span class="s">&#39;f1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">func</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s">&#39;V1&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s">&#39;f2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">func</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s">&#39;V2&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s">&#39;SW_Flag&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;f1&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;f2&#39;</span><span class="p">]</span>
        
        <span class="n">df</span><span class="p">[</span><span class="s">&#39;VL&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;V2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;SW_Flag&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;VL&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;SW_Flag&#39;</span><span class="p">])</span>
        <span class="n">df</span><span class="p">[</span><span class="s">&#39;VH&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;V1&#39;</span><span class="p">]</span><span class="o">*~</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;SW_Flag&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;VH&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;SW_Flag&#39;</span><span class="p">])</span>
        
        <span class="n">err</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;V1&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;V2&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">errflag</span><span class="o">=</span><span class="nb">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">&gt;.</span><span class="mo">01</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errflag</span><span class="o">=</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">&gt;.</span><span class="mo">01</span><span class="p">)</span>

        <span class="n">iterations</span><span class="o">=</span><span class="n">iterations</span><span class="o">+</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">iterations</span> <span class="o">&gt;</span><span class="mi">50</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;EXCEPTION:iterations exeeded maximum (50)&quot;</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s">&#39;V1&#39;</span><span class="p">)</span> <span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s">&#39;V1&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">pwr_optfcn</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">loc</span><span class="p">):</span></div>
<div class="viewcode-block" id="pwr_optfcn"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.pwr_optfcn.html#pvlib.pvsystem.pwr_optfcn">[docs]</a>    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    function to find power from I_from_V</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">I</span><span class="o">=</span><span class="n">I_from_V</span><span class="p">(</span><span class="n">Rsh</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Rsh&#39;</span><span class="p">],</span><span class="n">Rs</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Rs&#39;</span><span class="p">],</span> <span class="n">nNsVth</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;nNsVth&#39;</span><span class="p">],</span> <span class="n">V</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="n">I0</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;I0&#39;</span><span class="p">],</span> <span class="n">IL</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;IL&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">Voc_optfcn</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">loc</span><span class="p">):</span></div>
<div class="viewcode-block" id="Voc_optfcn"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.Voc_optfcn.html#pvlib.pvsystem.Voc_optfcn">[docs]</a>    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    function to find V_oc from I_from_V</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">I</span><span class="o">=-</span><span class="nb">abs</span><span class="p">(</span><span class="n">I_from_V</span><span class="p">(</span><span class="n">Rsh</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Rsh&#39;</span><span class="p">],</span> <span class="n">Rs</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Rs&#39;</span><span class="p">],</span> <span class="n">nNsVth</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;nNsVth&#39;</span><span class="p">],</span> <span class="n">V</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="n">I0</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;I0&#39;</span><span class="p">],</span> <span class="n">IL</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;IL&#39;</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">I</span>


<span class="k">def</span> <span class="nf">I_from_V</span><span class="p">(</span><span class="n">Rsh</span><span class="p">,</span> <span class="n">Rs</span><span class="p">,</span> <span class="n">nNsVth</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">IL</span><span class="p">):</span></div>
<div class="viewcode-block" id="I_from_V"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.I_from_V.html#pvlib.pvsystem.I_from_V">[docs]</a>    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    # calculates I from V per Eq 2 Jain and Kapoor 2004</span>
<span class="sd">    # uses Lambert W implemented in wapr_vec.m</span>
<span class="sd">    # Rsh, nVth, V, I0, IL can all be DataFrames</span>
<span class="sd">    # Rs can be a DataFrame, but should be a scalar</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">argW</span> <span class="o">=</span> <span class="n">Rs</span><span class="o">*</span><span class="n">I0</span><span class="o">*</span><span class="n">Rsh</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Rsh</span><span class="o">*</span><span class="p">(</span><span class="n">Rs</span><span class="o">*</span><span class="p">(</span><span class="n">IL</span><span class="o">+</span><span class="n">I0</span><span class="p">)</span><span class="o">+</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nNsVth</span><span class="o">*</span><span class="p">(</span><span class="n">Rs</span><span class="o">+</span><span class="n">Rsh</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="n">nNsVth</span><span class="o">*</span><span class="p">(</span><span class="n">Rs</span> <span class="o">+</span> <span class="n">Rsh</span><span class="p">))</span>
    <span class="n">inputterm</span> <span class="o">=</span><span class="n">lambertw</span><span class="p">(</span><span class="n">argW</span><span class="p">)</span>

    <span class="c"># Eqn. 4 in Jain and Kapoor, 2004</span>
    <span class="n">I</span> <span class="o">=</span> <span class="o">-</span><span class="n">V</span><span class="o">/</span><span class="p">(</span><span class="n">Rs</span> <span class="o">+</span> <span class="n">Rsh</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">nNsVth</span><span class="o">/</span><span class="n">Rs</span><span class="p">)</span> <span class="o">*</span> <span class="n">inputterm</span> <span class="o">+</span> <span class="n">Rsh</span><span class="o">*</span><span class="p">(</span><span class="n">IL</span> <span class="o">+</span> <span class="n">I0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Rs</span> <span class="o">+</span> <span class="n">Rsh</span><span class="p">)</span>
    

    <span class="k">return</span> <span class="n">I</span><span class="o">.</span><span class="n">real</span>


<span class="k">def</span> <span class="nf">snlinverter</span><span class="p">(</span><span class="n">Inverter</span><span class="p">,</span><span class="n">Vmp</span><span class="p">,</span><span class="n">Pmp</span><span class="p">):</span></div>
<div class="viewcode-block" id="snlinverter"><a class="viewcode-back" href="../../stubs/pvlib.pvsystem.snlinverter.html#pvlib.pvsystem.snlinverter">[docs]</a>  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Converts DC power and voltage to AC power using Sandia&#39;s Grid-Connected PV Inverter model</span>

<span class="sd">  Determine the AC power output of an inverter given the DC voltage, DC</span>
<span class="sd">  power, and appropriate Sandia Grid-Connected Photovoltaic Inverter</span>
<span class="sd">  Model parameters. The output, ACPower, is clipped at the maximum power</span>
<span class="sd">  output, and gives a negative power during low-input power conditions,</span>
<span class="sd">  but does NOT account for maximum power point tracking voltage windows</span>
<span class="sd">  nor maximum current or voltage limits on the inverter. </span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>

<span class="sd">  Inverter : DataFrame</span>

<span class="sd">           A DataFrame defining the inverter to be used, giving the</span>
<span class="sd">           inverter performance parameters according to the Sandia</span>
<span class="sd">           Grid-Connected Photovoltaic Inverter Model (SAND 2007-5036) [1]. A set of</span>
<span class="sd">           inverter performance parameters are provided with PV_LIB, or may be</span>
<span class="sd">           generated from a System Advisor Model (SAM) [2] library using pvl_retreivesam. </span>
<span class="sd">           </span>
<span class="sd">            Required DataFrame components are:</span>

<span class="sd">           =============   ==============================================================================================================================================================================================</span>
<span class="sd">           Field            DataFrame</span>
<span class="sd">           =============   ==============================================================================================================================================================================================</span>
<span class="sd">           Inverter.Pac0   AC-power output from inverter based on input power and voltage, (W) </span>
<span class="sd">           Inverter.Pdc0   DC-power input to inverter, typically assumed to be equal to the PV array maximum power, (W)</span>
<span class="sd">           Inverter.Vdc0   DC-voltage level at which the AC-power rating is achieved at the reference operating condition, (V)</span>
<span class="sd">           Inverter.Ps0    DC-power required to start the inversion process, or self-consumption by inverter, strongly influences inverter efficiency at low power levels, (W)</span>
<span class="sd">           Inverter.C0     Parameter defining the curvature (parabolic) of the relationship between ac-power and dc-power at the reference operating condition, default value of zero gives a linear relationship, (1/W)</span>
<span class="sd">           Inverter.C1     Empirical coefficient allowing Pdco to vary linearly with dc-voltage input, default value is zero, (1/V)</span>
<span class="sd">           Inverter.C2     empirical coefficient allowing Pso to vary linearly with dc-voltage input, default value is zero, (1/V)</span>
<span class="sd">           Inverter.C3     empirical coefficient allowing Co to vary linearly with dc-voltage input, default value is zero, (1/V)</span>
<span class="sd">           Inverter.Pnt    ac-power consumed by inverter at night (night tare) to maintain circuitry required to sense PV array voltage, (W)</span>
<span class="sd">           =============   ==============================================================================================================================================================================================</span>
<span class="sd">  </span>
<span class="sd">  Vdc : float or DataFrame</span>
<span class="sd">          DC voltages, in volts, which are provided as input to the inverter. Vdc must be &gt;= 0.</span>
<span class="sd">  Pdc : float or DataFrame</span>

<span class="sd">          A scalar or DataFrame of DC powers, in watts, which are provided</span>
<span class="sd">           as input to the inverter. Pdc must be &gt;= 0.</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>

<span class="sd">  ACPower : float or DataFrame</span>

<span class="sd">           Mdeled AC power output given the input </span>
<span class="sd">           DC voltage, Vdc, and input DC power, Pdc. When ACPower would be </span>
<span class="sd">           greater than Pac0, it is set to Pac0 to represent inverter </span>
<span class="sd">           &quot;clipping&quot;. When ACPower would be less than Ps0 (startup power</span>
<span class="sd">           required), then ACPower is set to -1*abs(Pnt) to represent nightly </span>
<span class="sd">           power losses. ACPower is not adjusted for maximum power point</span>
<span class="sd">           tracking (MPPT) voltage windows or maximum current limits of the</span>
<span class="sd">           inverter.</span>

<span class="sd">  References</span>
<span class="sd">  ----------</span>

<span class="sd">  [1] (SAND2007-5036, &quot;Performance Model for Grid-Connected Photovoltaic </span>
<span class="sd">  Inverters by D. King, S. Gonzalez, G. Galbraith, W. Boyson)</span>

<span class="sd">  [2] System Advisor Model web page. https://sam.nrel.gov.</span>

<span class="sd">  See also</span>
<span class="sd">  --------</span>

<span class="sd">  pvl_sapm</span>
<span class="sd">  pvl_samlibrary</span>
<span class="sd">  pvl_singlediode</span>

<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>
  <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Inverter&#39;</span><span class="p">:(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
      <span class="s">&#39;Vmp&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">,</span>
      <span class="s">&#39;Pmp&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">}</span>

  <span class="n">var</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>

  <span class="n">Paco</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Inverter</span><span class="p">[</span><span class="s">&#39;Paco&#39;</span><span class="p">]</span>
  <span class="n">Pdco</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Inverter</span><span class="p">[</span><span class="s">&#39;Pdco&#39;</span><span class="p">]</span>
  <span class="n">Vdco</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Inverter</span><span class="p">[</span><span class="s">&#39;Vdco&#39;</span><span class="p">]</span>
  <span class="n">Pso</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Inverter</span><span class="p">[</span><span class="s">&#39;Pso&#39;</span><span class="p">]</span>
  <span class="n">C0</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Inverter</span><span class="p">[</span><span class="s">&#39;C0&#39;</span><span class="p">]</span>
  <span class="n">C1</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Inverter</span><span class="p">[</span><span class="s">&#39;C1&#39;</span><span class="p">]</span>
  <span class="n">C2</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Inverter</span><span class="p">[</span><span class="s">&#39;C2&#39;</span><span class="p">]</span>
  <span class="n">C3</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Inverter</span><span class="p">[</span><span class="s">&#39;C3&#39;</span><span class="p">]</span>
  <span class="n">Pnt</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Inverter</span><span class="p">[</span><span class="s">&#39;Pnt&#39;</span><span class="p">]</span>


  <span class="n">A</span><span class="o">=</span><span class="n">Pdco</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">C1</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Vmp</span> <span class="o">-</span> <span class="n">Vdco</span><span class="p">))))</span>
  <span class="n">B</span><span class="o">=</span><span class="n">Pso</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">C2</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Vmp</span> <span class="o">-</span> <span class="n">Vdco</span><span class="p">))))</span>
  <span class="n">C</span><span class="o">=</span><span class="n">C0</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">C3</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Vmp</span> <span class="o">-</span> <span class="n">Vdco</span><span class="p">))))</span>
  <span class="n">ACPower</span><span class="o">=</span><span class="p">((</span><span class="n">Paco</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span><span class="p">))</span> <span class="o">-</span> <span class="n">C</span><span class="o">*</span><span class="p">((</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span><span class="p">)))</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Pmp</span> <span class="o">-</span> <span class="n">B</span><span class="p">))</span> <span class="o">+</span> <span class="n">C</span><span class="o">*</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Pmp</span> <span class="o">-</span> <span class="n">B</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
  <span class="n">ACPower</span><span class="p">[</span><span class="n">ACPower</span> <span class="o">&gt;</span> <span class="n">Paco</span><span class="p">]</span><span class="o">=</span><span class="n">Paco</span>
  <span class="n">ACPower</span><span class="p">[</span><span class="n">ACPower</span> <span class="o">&lt;</span> <span class="n">Pso</span><span class="p">]</span><span class="o">=-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Pnt</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">ACPower</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">PV LIB 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Sandia National Labs.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>